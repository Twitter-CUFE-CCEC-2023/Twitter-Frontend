<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: TimeLinePage/TweetPage/TweetAndReplies.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: TimeLinePage/TweetPage/TweetAndReplies.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from "react";
import FeedTweet from "../MiddlePage/FeedTweet";
import classes from "./TweetAndReplies.module.css";
// import defaultMaleProfile from '../../../Assets/defaultMaleProfile.jpg'
import FeedTweetBox from "../MiddlePage/UpperTweetBox/FeedTweetBox";
import ArrowBackIcon from "@material-ui/icons/ArrowBack";
import { NavLink } from "react-router-dom";
import { useParams } from "react-router-dom/cjs/react-router-dom.min";
import axios from "axios";
// import { useHistory } from 'react-router-dom';
// import { SkipPreviousRounded } from '@material-ui/icons';
import instance from "../../axios";
import ReactLoading from "react-loading";
import { useHistory } from "react-router-dom";
/**
 * Gets the The tweet from the tweetId and its replies from the backend and renders them
 * using /status/tweet/${id}?include_replies=true
 * 
 */
function TweetAndReplies(props) {
  let { userId, id } = useParams();
  if (props.isShowPhotos) id = window.location.pathname.split("/")[3];
  const [isLoading, setLoading] = React.useState(true);
  const [topTweet, setTopTweet] = React.useState([]);
  const [replies, setReplies] = React.useState([]);
  const [topUser, setTopUser] = React.useState(null);

  let isMock = localStorage.getItem("isMock") === "true";

  React.useEffect(() => getTweet(), [props.increment]);

  const getTweet = async () => {
    const splitPath = prevPath.split("/");
    if (splitPath.length &lt; 4) {
      const prevPage = {
        prevPath: prevPath,
        tweetId: id,
      };
      localStorage.setItem("homeBack", JSON.stringify(prevPage));
    }

    let maintweet;
    let replies;
    if (!isMock) {
      let TweetAndReplies = props.testUrl
        ? await axios.get(props.testUrl)
        : await instance.get(`/status/tweet/${id}?include_replies=true`);
      maintweet = TweetAndReplies.data.tweet;
      replies = TweetAndReplies.data.tweet.replies;
    } else {
      await fetch(`http://localhost:3000/replies/${id}`)
        .then((res) => res.json())
        .then((data) => {
          maintweet = data;
          replies = data.replies;
        });
    }

    let tweet = {
      name: maintweet.user.name,
      profilePic: maintweet.user.profile_image_url,
      userName: maintweet.user.username,
      isVerified: maintweet.user.isVerified,
      bio: maintweet.user.bio,
      followers: maintweet.user.followers_count,
      following: maintweet.user.following_count,
      isFollowing: maintweet.user.is_followed,
      text: maintweet.content,
      tweetId: maintweet.id,
      date: maintweet.created_at,
      replies: maintweet.replies,
      likes: maintweet.likes_count,
      retweets: maintweet.retweets_count,
      quotes: maintweet.quotes_count,
      isLiked: maintweet.is_liked,
      isRetweeted: maintweet.is_retweeted,
      isReply: maintweet.is_reply,
      media: maintweet.media,
      gif : maintweet.gif ? maintweet.gif : "",
    };
    let tu = {
      name: maintweet.user.name,
      profilePic: maintweet.user.profile_image_url,
      userName: maintweet.user.username,
      isVerified: maintweet.user.isVerified,
      bio: maintweet.user.bio,
      followers: maintweet.user.followers_count,
      following: maintweet.user.following_count,
      isFollowing: maintweet.user.is_followed,
    };
    let repl = replies.map((reply) => {
      return {
        name: reply.user.name,
        profilePic: reply.user.profile_image_url,
        userName: reply.user.username,
        isVerified: reply.user.isVerified,
        bio: reply.user.bio,
        followers: reply.user.followers_count,
        following: reply.user.following_count,
        isFollowing: reply.user.is_followed,
        text: reply.content,
        tweetId: reply.id,
        date: reply.created_at,
        replies: reply.replies,
        likes: reply.likes_count,
        retweets: reply.retweets_count,
        quotes: reply.quotes_count,
        isLiked: reply.is_liked,
        isRetweeted: reply.is_retweeted,
        isReply: reply.is_reply,
        media: reply.media,
        gif : reply.gif ? reply.gif : "",
      };
    });
    setTopTweet(tweet);
    setTopUser(tu);
    setReplies(repl);
    setLoading(false);
  };

  //console.log(replies);

  function goBack() {
    localStorage.setItem("currentPage", prevPath);
    const prevPage = localStorage.getItem("homeBack")
      ? JSON.parse(localStorage.getItem("homeBack"))
      : null;
    history.push(
      prevPage &amp;&amp; prevPage.tweetId === String(id) ? prevPage.prevPath : prevPath
    );
    window.location.reload();
  }

  let history = useHistory();
  let prevPath = localStorage.getItem("currentPage")
    ? localStorage.getItem("currentPage")
    : "/home";

  if (isLoading) {
    return (
      &lt;div
        className={`${classes.TweetAndReplies} ${
          props.isShowPhotos &amp;&amp; classes.widthPhotos
        }`}
      >
        {!props.isShowPhotos &amp;&amp; (
          &lt;div className={classes.tweetHeader}>
            &lt;NavLink className={classes.nlink} to={prevPath} onClick={goBack}>
              &lt;ArrowBackIcon className={`${classes.fs20} ${classes.icon}`} />
            &lt;/NavLink>
            &lt;h2 className={`${classes.headerText} ${classes.fs20}`}>Tweet&lt;/h2>
          &lt;/div>
        )}
        {isLoading &amp;&amp; (
          &lt;ReactLoading
            type={"spin"}
            color={"#1DA1F2"}
            height={"4%"}
            width={"4%"}
            className={`${classes.loadingIcon}`}
          />
        )}
      &lt;/div>
    );
  }

  return (
    &lt;div
      className={`${classes.TweetAndReplies} ${
        props.isShowPhotos &amp;&amp; classes.widthPhotos
      }`}
    >
      {!props.isShowPhotos &amp;&amp; (
        &lt;div className={classes.tweetHeader}>
          &lt;NavLink className={classes.nlink} to={prevPath} onClick={goBack}>
            &lt;ArrowBackIcon className={`${classes.fs20} ${classes.icon}`} />
          &lt;/NavLink>
          &lt;h2 className={`${classes.headerText} ${classes.fs20}`}>Tweet&lt;/h2>
        &lt;/div>
      )}
      &lt;div data-testid="topTweet">
        &lt;FeedTweet
          isShowPhotos={props.isShowPhotos}
          isTopTweet={true}
          {...topTweet}
          setPhotosActive={props.setPhotosActive}
          setIncrement={props.setIncrement}
        />
      &lt;/div>
      &lt;div className={classes.tbox}>
        {" "}
        &lt;FeedTweetBox isReply={true} Id={topTweet.tweetId} />{" "}
      &lt;/div>
      {isLoading &amp;&amp; (
        &lt;ReactLoading
          type={"spin"}
          color={"#1DA1F2"}
          height={"4%"}
          width={"4%"}
          className={`${classes.loadingIcon}`}
        />
      )}
      {replies.map((tweet, index) => {
        return (
          &lt;FeedTweet
            {...tweet}
            isReply={true}
            topUser={topUser}
            showAction={true}
            key={index}
            setPhotosActive={props.setPhotosActive}
            setIncrement={props.setIncrement}
          />
        );
      })}
    &lt;/div>
  );
}

export default TweetAndReplies;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AccountButton">AccountButton</a></li><li><a href="global.html#DeleteModal">DeleteModal</a></li><li><a href="global.html#ImageGrid">ImageGrid</a></li><li><a href="global.html#LeftSideBar">LeftSideBar</a></li><li><a href="global.html#MiniProfile">MiniProfile</a></li><li><a href="global.html#MoreButton">MoreButton</a></li><li><a href="global.html#PhotosPage">PhotosPage</a></li><li><a href="global.html#rotateSize">rotateSize</a></li><li><a href="global.html#TweetAndReplies">TweetAndReplies</a></li><li><a href="global.html#TweetAtrribute">TweetAtrribute</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Tue May 24 2022 20:05:32 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
