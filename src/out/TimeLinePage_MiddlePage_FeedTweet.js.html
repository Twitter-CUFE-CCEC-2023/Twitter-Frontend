<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: TimeLinePage/MiddlePage/FeedTweet.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: TimeLinePage/MiddlePage/FeedTweet.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState } from "react";
// import { useEffect, useRef } from "react";
import classes from "./FeedTweet.module.css";
import ChatBubbleOutlineOutlinedIcon from "@material-ui/icons/ChatBubbleOutlineOutlined";
import LoopOutlinedIcon from "@material-ui/icons/LoopOutlined";
import FavoriteBorderOutlinedIcon from "@material-ui/icons/FavoriteBorderOutlined";
import FavoriteIcon from "@material-ui/icons/Favorite";
import ShareOutlinedIcon from "@material-ui/icons/ShareOutlined";
//import VerifiedIcon from '@material-ui/icons/Verified';
import CheckCircleIcon from "@material-ui/icons/CheckCircle";
import TweetAtrribute from "./TweetAtrribute";
import MiniProfile from "../MiniProfile";
import { NavLink } from "react-router-dom";
import TopTweetAttributes from "./TopTweetAttributes";
// import axios from "axios";
import { useHistory } from "react-router-dom/cjs/react-router-dom.min";
import ImageGrid from "./ImageGrid";
import PhotosPage from "../ViewPhotosPage/PhotosPage";
import DefaultProfilePic from "../../../Assets/DefaultProfilePic.jpg";
import FeedTweetMore from "./FeedTweetMore";
// import { LinkSharp } from "@material-ui/icons";
// import { react } from "fontawesome";
import FeedTweetReplyModal from "./ReplyTweet/FeedTweetReplyModal";
/**
 * Tweet Component to show tweets through out the application.
 * 
 * @param  {Tweet} tweet The tweet which is to be rendered
 * @param  {Set} followingSet The set of the users which the user is following to sync for home page
 * @param  {Boolean} isTopTweet Whether the tweet is the top tweet or not for the Tweet page
 * @param  {Boolean} isReply Whether the tweet is a reply or not for the Tweet page
 */
export default function FeedTweet(props) {
  const [replyModal, setReplyModal] = useState(false);
  function viewReplyModal() {
    setReplyModal(true);
  }

  const [isDeleted, setIsDeleted] = useState(false);

  const [isFollowing, setIsFollowing] = useState(
    props.followingSet
      ? props.followingSet.has(props.userName)
      : props.isFollowing
  );

  React.useEffect(() => {
    if (props.followingSet) {
      if (props.followingSet.has(props.userName)) {
        setIsFollowing(true);
      } else {
        setIsFollowing(false);
      }
    }
  }, [props.followingSet]);

  // function hideReplyModal() {
  //   setReplyModal(false);
  // }
  function hideReplyModal() {
    setReplyModal(false);
  }

  // {
  //   console.log(props.img);
  // }
  const tweetDate = new Date(props.date);
  const months = [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "May",
    "Jun",
    "Jul",
    "Aug",
    "Sep",
    "Oct",
    "Nov",
    "Dec",
  ];
  function getDateDiff(date) {
    const date1 = new Date(date);
    const date2 = new Date();
    const diffTime = Math.abs(date2 - date1);
    const diffSeconds = Math.floor(diffTime / 1000);
    const diffMinutes = Math.floor(diffTime / (1000 * 60));
    const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    const diffYears = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 365));

    if (diffYears > 0) {
      return `${
        months[date1.getMonth()]
      } ${date1.getDate()}, ${date1.getFullYear()}`;
    }
    if (diffDays > 0) {
      return `${months[date1.getMonth()]} ${date1.getDate()}`;
    }
    if (diffHours > 0) {
      return `${diffHours}h`;
    }
    if (diffMinutes > 0) {
      return `${diffMinutes}m`;
    }
    if (diffSeconds > 0) {
      return `${diffSeconds}s`;
    }
  }

  const imageExtenionsSet = new Set(["jpg", "jpeg", "png", "webp"]);
  const videoExtenionsSet = new Set(["mp4", "avi", "mkv"]);

  function getMediaType() {
    if (props.media) {
      if (props.media.length > 0) {
        if (imageExtenionsSet.has(props.media[0].split(".")[3])) {
          return "image";
        } else if (videoExtenionsSet.has(props.media[0].split(".")[3])) {
          return "video";
        } else {
          return "gif";
        }
      }
    }
  }

  // let observer = React.createRef();
  const [tweetText, setTweetText] = useState(props.text);

  let profilePic = props.profilePic ? props.profilePic : DefaultProfilePic;

  React.useEffect(() => setTweetText(linkify(props.text)), []);

  function linkify(inputText) {
    var replacedText, replacePattern1, replacePattern2, replacePattern3;

    //URLs starting with http://, https://, or ftp://
    replacePattern1 =
      /(\b(https?|ftp):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])/gim;
    if (inputText) {
      replacedText = inputText.replace(
        replacePattern1,
        `&lt;div name = "link" > &lt;a href="$1" target="_blank">$1&lt;/a> &lt;/div>`
      );
    }

    //URLs starting with "www." (without // before it, or it'd re-link the ones done above).
    replacePattern2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
    if (replacedText) {
      replacedText = replacedText.replace(
        replacePattern2,
        `&lt;div name = "link" >$1&lt;a href="http://$2" target="_blank">$2&lt;/a>&lt;/div>`
      );
    }

    //Change email addresses to mailto:: links.
    if (replacedText) {
      replacePattern3 =
        /(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim;
      replacedText = replacedText.replace(
        replacePattern3,
        `&lt;div name = "link" >&lt;a href="mailto:$1">$1&lt;/a>&lt;/div>`
      );
    }

    //console.log(replacedText);
    return replacedText;
  }
  React.useEffect(() => {
    // console.log("changed");
    let links = document.getElementsByName("link");
    links.forEach((link) => {
      link.addEventListener("click", (e) => {
        e.stopPropagation();
      });
    });
  }, [tweetText]);

  let tweet = {
    content: props.text,
    dateCreated: props.date,
    likes: props.likes,
    retweets: props.retweets,
    replies: props.replies,
    id: props.tweetId,
    userId: props.userId,
  };

  const [activePhotos, setActivePhotos] = useState(false);

  let history = useHistory();
  function handleClick(e) {
    if (!props.isTopTweet) {
      localStorage.setItem("currentPage", window.location.pathname);
      history.push(`/${props.userName}/status/${props.tweetId}`);
      window.location.reload();
    }
  }

  if (isDeleted) {
    return null;
  }

  return (
    &lt;div onClick={handleClick} className={classes.FeedTweet}>
      {/* {!props.isShowPhotos &amp;&amp; activePhotos &amp;&amp; &lt;PhotosPage className={classes.absolute}/>} */}
      &lt;div
        id={`Tweet${props.tweetId}`}
        className={props.isTopTweet ? classes.topTweet : classes.feedTweet}
      >
        &lt;div onClick={(e) => e.stopPropagation()}>
          {replyModal &amp;&amp; (
            &lt;FeedTweetReplyModal
              onHide={hideReplyModal}
              {...props}
              addRepliesNum={() => {}}
            >&lt;/FeedTweetReplyModal>
          )}
        &lt;/div>
        {/* &lt;NavLink
          to={`/userProfile/${props.userName}`}
          className={classes.fs15  + " " + classes.noStyle}
        > */}
        &lt;img
          onClick={(e) => {
            e.stopPropagation();
            history.push(`/userProfile/${props.userName}`);
            window.location.reload();
          }}
          className={classes.profilePic + " " + classes.minip}
          alt="profile"
          src={profilePic}
        >&lt;/img>
        &lt;div
          onClick={(e) => {
            e.stopPropagation();
            e.preventDefault();
          }}
          className={classes.hoverProfile + " " + classes.top}
        >
          &lt;MiniProfile
            profilePic={profilePic}
            name={props.name}
            userName={props.userName}
            profileDesciption={props.bio}
            following={props.following}
            followers={props.followers}
            isFollowing={isFollowing}
            setIsFollowing={setIsFollowing}
            setFollowingSet={props.setFollowingSet}
          />
        &lt;/div>
        {/* &lt;/NavLink> */}

        &lt;div className={classes.tweet}>
          &lt;div className={classes.user}>
            &lt;NavLink
              to={`/userprofile/${props.userName}`}
              className={
                classes.fs15 + " " + classes.minip + " " + classes.noStyle
              }
            >
              &lt;h2
                onClick={(e) => {
                  e.stopPropagation();
                }}
                data-testid="name"
                className={
                  classes.underline +
                  " " +
                  classes.fs15 +
                  " " +
                  classes.pointer +
                  " " +
                  classes.alignTop
                }
              >
                {props.name}{" "}
                {props.isVerified &amp;&amp; (
                  &lt;CheckCircleIcon className={classes.verifiedIcon} />
                )}
              &lt;/h2>
            &lt;/NavLink>
            &lt;div
              onClick={(e) => {
                e.stopPropagation();
              }}
              className={classes.hoverProfile + " " + classes.bot}
            >
              &lt;MiniProfile
                profilePic={profilePic}
                name={props.name}
                userName={props.userName}
                profileDesciption={props.bio}
                following={props.following}
                followers={props.followers}
                isFollowing={isFollowing}
                setIsFollowing={setIsFollowing}
                setFollowingSet={props.setFollowingSet}
              />
            &lt;/div>
            &amp;nbsp;
            &lt;NavLink
              to={`/userprofile/${props.userName}`}
              className={
                classes.fs15 + " " + classes.minip + " " + classes.noStyle
              }
            >
              &lt;p
                onClick={(e) => {
                  e.stopPropagation();
                }}
                className={
                  classes.gray +
                  " " +
                  classes.minip +
                  " " +
                  classes.fs15 +
                  " " +
                  classes.pointer +
                  " " +
                  classes.alignTop
                }
                data-testid="userName"
              >
                @{props.userName}
              &lt;/p>
            &lt;/NavLink>
            &lt;div
              onClick={(e) => {
                e.stopPropagation();
              }}
              className={classes.hoverProfile + " " + classes.bot}
            >
              &lt;MiniProfile
                profilePic={profilePic}
                name={props.name}
                userName={props.userName}
                profileDesciption={props.bio}
                following={props.following}
                followers={props.followers}
                isFollowing={isFollowing}
                setIsFollowing={setIsFollowing}
                setFollowingSet={props.setFollowingSet}
              />
            &lt;/div>
            &amp;nbsp;{!props.isTopTweet &amp;&amp; &lt;p className={classes.gray}>.&lt;/p>}&amp;nbsp;
            {!props.isTopTweet &amp;&amp; (
              &lt;p
                className={
                  classes.gray + " " + classes.underline + " " + classes.fs15
                }
                data-testid="date"
              >
                {getDateDiff(props.date)}
              &lt;/p>
            )}
            &lt;div className={classes.moreIcon}>
              &lt;FeedTweetMore
                userName={props.userName}
                tweetId={props.tweetId}
                setIsDeleted={setIsDeleted}
                isFollowing={isFollowing}
                setIsFollowing={setIsFollowing}
                setFollowingSet={props.setFollowingSet}
              />
            &lt;/div>
          &lt;/div>
          {props.isReply &amp;&amp; !props.isTopTweet &amp;&amp; (
            &lt;div className={classes.flex}>
              &lt;p className={`${classes.gray} ${classes.fs15} ${classes.nom}`}>
                Replying to{" "}
              &lt;/p>
              &amp;nbsp;
              &lt;p
                className={`${classes.gray}  ${classes.fs15} ${classes.minip} ${classes.replyat} ${classes.nom}`}
              >
                @{props.topUser ? props.topUser.userName : ""}
              &lt;/p>
              &lt;div
                className={classes.hoverProfile + " " + classes.repmin}
                onClick={(e) => e.stopPropagation()}
              >
                &lt;MiniProfile
                  profilePic={
                    props.topUser
                      ? props.topUser.profilePic
                        ? props.topUser.profilePic
                        : DefaultProfilePic
                      : ""
                  }
                  name={props.topUser ? props.topUser.name : ""}
                  userName={props.topUser ? props.topUser.userName : ""}
                  profileDesciption={props.topUser ? props.topUser.bio : ""}
                  following={props.topUser.following}
                  followers={props.topUser.followers}
                  isFollowing={props.topUser.isFollowing}
                />
              &lt;/div>
            &lt;/div>
          )}
          &lt;div
            data-testid="text"
            className={classes.fs15 + " " + classes.txt}
            dangerouslySetInnerHTML={{ __html: tweetText }}
          >&lt;/div>
          {props.media &amp;&amp;
            !props.isShowPhotos &amp;&amp;
            props.media.length > 0 &amp;&amp;
            getMediaType() === "image" &amp;&amp; (
              &lt;ImageGrid
                media={props.media}
                userName={props.userName}
                tweetId={props.tweetId}
                setPhotosActive={props.setPhotosActive}
                setIncrement={props.setIncrement}
              />
            )}

          {props.media &amp;&amp; !props.isShowPhotos &amp;&amp; props.gif &amp;&amp; (
            &lt;img
              onClick={(e) => e.stopPropagation()}
              className={classes.gif}
              src={props.gif}
            >&lt;/img>
          )}

          {props.isTopTweet &amp;&amp; (
            &lt;div
              className={classes.flex + " " + classes.gray + " " + classes.m10}
            >
              &lt;p
                className={
                  classes.underline + " " + classes.fs15 + " " + classes.pointer
                }
              >
                {`${tweetDate.getHours()}:${tweetDate.getMinutes()} . ${
                  months[tweetDate.getMonth()]
                } ${tweetDate.getDay()}, ${tweetDate.getFullYear()}`}
              &lt;/p>
            &lt;/div>
          )}

          {!props.isTopTweet &amp;&amp; (
            &lt;div id="FeedTweetAttributes" className={classes.attributes}>
              &lt;TweetAtrribute
                Icon={ChatBubbleOutlineOutlinedIcon}
                num={props.repliesCount ? props.repliesCount : 0}
                color="b"
                tooltip="Reply"
                onClick={viewReplyModal}
                tweet={tweet}
              />
              &lt;TweetAtrribute
                Icon={LoopOutlinedIcon}
                num={props.retweets}
                color="g"
                tooltip="Retweet"
                isRetweeted={props.isRetweeted}
                tweet={tweet}
              />
              &lt;TweetAtrribute
                Icon={FavoriteBorderOutlinedIcon}
                FilledIcon={FavoriteIcon}
                num={props.likes}
                color="r"
                tooltip="Like"
                isLiked={props.isLiked}
                tweet={tweet}
              />
              &lt;TweetAtrribute
                isLiked={props.isLiked}
                isRetweeted={props.isRetweeted}
                Icon={ShareOutlinedIcon}
                color="b"
                tooltip="Share"
                tweet={tweet}
              />
            &lt;/div>
          )}

          {props.isTopTweet &amp;&amp; (
            &lt;TopTweetAttributes
              isLiked={props.isLiked}
              isRetweeted={props.isRetweeted}
              tweet={tweet}
              likes={props.likes}
              retweets={props.retweets}
              quoteTweets={props.quotes}
              isShowPhotos={props.isShowPhotos}
              {...props}
            />
          )}
        &lt;/div>
        {/* {!props.showAction &amp;&amp; &lt;div>&lt;/div>} */}
      &lt;/div>
    &lt;/div>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AccountButton">AccountButton</a></li><li><a href="global.html#DeleteModal">DeleteModal</a></li><li><a href="global.html#ImageGrid">ImageGrid</a></li><li><a href="global.html#LeftSideBar">LeftSideBar</a></li><li><a href="global.html#MiniProfile">MiniProfile</a></li><li><a href="global.html#MoreButton">MoreButton</a></li><li><a href="global.html#PhotosPage">PhotosPage</a></li><li><a href="global.html#rotateSize">rotateSize</a></li><li><a href="global.html#TweetAndReplies">TweetAndReplies</a></li><li><a href="global.html#TweetAtrribute">TweetAtrribute</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Tue May 24 2022 20:05:32 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
