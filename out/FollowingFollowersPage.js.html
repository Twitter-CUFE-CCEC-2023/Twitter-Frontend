<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: FollowingFollowersPage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: FollowingFollowersPage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect, useRef, useCallback } from "react";
import classes from "./FollowingFollowersPage.module.css";
import LeftSideBar from "../../TimeLinePage/LeftSideBar/LeftSideBar";
import RightSideBar from "../../TimeLinePage/RightSideBar/RightSideBar";
import ProfileHeader from "../ProfileHeader";
import User from "./User";
import ReactLoading from "react-loading";
import { NavLink } from "react-router-dom/cjs/react-router-dom.min";
import { useLocation } from "react-router-dom";
import axios from "axios";
import instance from "../../axios";
import { useParams } from "react-router-dom";
import { diceSix } from "fontawesome";

function FollowingFollowersPage() {
  /**
   * @module FollowingFollowersPage
   */
  const currentuser = JSON.parse(localStorage.getItem("UserInfo"));
  let currentuserName = currentuser.username;
  const pathlocation = useLocation();
  let type = pathlocation.pathname.split("/")[1];
  const [followersSelected, setFollowersSelected] = useState(
    type === "followers" ? true : false
  );
  const [followingSelected, setFollowingSelected] = useState(
    type === "following" ? true : false
  );
  const [user, setUser] = useState({});
  const [followers, setFollowers] = useState([]);
  const [following, setFollowing] = useState([]);
  const [isLoading, setLoading] = useState(true);
  const [pageNumberFollowers, setPageNumberFollowers] = React.useState(0);
  const [pageNumberFollowing, setPageNumberFollowing] = React.useState(0);
  const [hasMoreFollowers, setHasMoreFollowers] = React.useState(true);
  const [hasMoreFollowing, setHasMoreFollowing] = React.useState(true);
  const location = useLocation();
  let { userName } = useParams();
  let isMock = localStorage.getItem("isMock") === "true";
  const observerFollowers = useRef();
  const observerFollowing = useRef();

  const lastTweetElementRefFollowers = useCallback(
    (node) => {
      if (isLoading) return;
      if (observerFollowers.current) observerFollowers.current.disconnect();
      observerFollowers.current = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting &amp;&amp; hasMoreFollowers) {
          setPageNumberFollowers(
            (prevPageNumberFollowers) => prevPageNumberFollowers + 1
          );
        }
      });
      if (node) observerFollowers.current.observe(node);
    },
    [isLoading, hasMoreFollowers]
  );

  const lastTweetElementRefFollowing = useCallback(
    (node) => {
      if (isLoading) return;
      if (observerFollowing.current) observerFollowing.current.disconnect();
      observerFollowing.current = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting &amp;&amp; hasMoreFollowing) {
          setPageNumberFollowing(
            (prevPageNumberFollowing) => prevPageNumberFollowing + 1
          );
        }
      });
      if (node) observerFollowing.current.observe(node);
    },
    [isLoading, hasMoreFollowing]
  );

  useEffect(() => {
    console.log(type,"page type")
    if (type === "followers") {
      setFollowers(()=>{return[]});
      if(pageNumberFollowers === 1){
        getUsers();
      }
      else
      setPageNumberFollowers(()=>{return 1});

    }
    if (type === "following") {
      setFollowing(()=>{return[]});
      if(pageNumberFollowing === 1){
       getUsers();
      }
      else
      setPageNumberFollowing(()=>{return 1});
    }
  }, [type]);

  useEffect(() => {
    console.log( "followersSelected")
    getUsers();
  }, [pageNumberFollowers, pageNumberFollowing]);

  /**
   * @name getUsers
   * @function getUsers
   * @description get users of followers or following
   */
  const getUsers = async () => {
    setLoading(true);
    //get user info from database
    if (!isMock) {
      const res = await instance.get(`/info/${userName}`);

      const userInfo = res.data.user;
      setUser(userInfo);
    }
    //get user info from mock
    else {
    }
    if (type === "followers") {
      let userFollowers;
      if (!isMock) {
        console.log(pageNumberFollowers, "page number followers");
        const res = await instance
          .get(`/follower/list/${userName}/${pageNumberFollowers}/6`)
          .catch(function (error) {
            if (error.response) {
              console.log(error.response.data);
              console.log(error.response.status);
              console.log(error.response.headers);
            } else if (error.request) {
              console.log(error.request);
            } else {
              console.log("Error", error.message);
            }
          });
        userFollowers = res.data.followers;
      } else {
        await fetch(
          `http://localhost:3000/followerslist/${userName}?_page=${pageNumberFollowers}&amp;_limit=6`
        )
          .then((res) => res.json())
          .then((data) => {
            userFollowers = data.followers;
          });
      }
      userFollowers.forEach((APIfollower) => {
        let follower = {
          name: APIfollower.name,
          profilePic: APIfollower.profile_image_url,
          userName: APIfollower.username,
          // isVerified: APIfollower.isVerified,
          bio: APIfollower.bio,
          followers: APIfollower.followers_count,
          following: APIfollower.following_count,
          isFollowing: APIfollower.is_followed,
        };
        setFollowers((prevFollowers) => {
          return [...prevFollowers, follower];
        });
      });
      setHasMoreFollowers(userFollowers.length === 6);
      setLoading(false);
    }
    if (type === "following") {
      let userFollowings;
      console.log(pageNumberFollowing, "page number following");
      if (!isMock) {
        const res = await instance
          .get(`/following/list/${userName}/${pageNumberFollowing}/6`)
          .catch(function (error) {
            if (error.response) {
              console.log(error.response.data);
              console.log(error.response.status);
              console.log(error.response.headers);
            } else if (error.request) {
              console.log(error.request);
            } else {
              console.log("Error", error.message);
            }
          });
        userFollowings = res.data.followings;
      } else {
        await fetch(
          `http://localhost:3000/followingslist/${userName}?_page=${pageNumberFollowers}&amp;_limit=6`
        )
          .then((res) => res.json())
          .then((data) => {
            userFollowings = data.followings;
          });
      }
      userFollowings.forEach((APIfollowing) => {
        let followingUser = {
          name: APIfollowing.name,
          profilePic: APIfollowing.profile_image_url,
          userName: APIfollowing.username,
          // isVerified: APIfollower.isVerified,
          bio: APIfollowing.bio,
          followers: APIfollowing.followers_count,
          following: APIfollowing.following_count,
          isFollowing: APIfollowing.is_followed,
        };
        setFollowing((prevFollowing) => {
          return [...prevFollowing, followingUser];
        });
      });
      setHasMoreFollowing(userFollowings.length === 6);
      setLoading(false);
    }
  };

  const onClickFollowers = () => {
    setFollowersSelected(() => {
      return true;
    });
    setFollowingSelected(() => {
      return false;
    });
  };
  const onClickFollowing = () => {
    setFollowersSelected(() => {
      return false;
    });
    setFollowingSelected(() => {
      return true;
    });
  };

  return (
    &lt;div className={classes.followingFollowersPage}>
      &lt;LeftSideBar />
      &lt;div className={classes.followingFollowersContainer}>
        &lt;div className={`${classes.header} row`}>
          &lt;ProfileHeader
            className={`${classes.infoHeader} `}
            name={user.name}
            username={user.username}
          >&lt;/ProfileHeader>

          &lt;div className={`${classes.headerTabs}`}>
            &lt;NavLink
              to={`/followers/${userName}`}
              className={`${
                followersSelected ? classes.selectedTab : classes.tab
              } col pb-0 text-muted btn `}
              onClick={onClickFollowers}
            >
              &lt;div className={` align-self-center`}>
                &lt;p className={`mb-2`}> Followers&lt;/p>{" "}
              &lt;/div>
              {followersSelected ? (
                &lt;div className={`${classes.tabdiv} align-self-center`}>&lt;/div>
              ) : (
                &lt;div>&lt;/div>
              )}
            &lt;/NavLink>
            &lt;NavLink
              to={`/following/${userName}`}
              className={`${
                followingSelected ? classes.selectedTab : classes.tab
              } col pb-0 text-muted btn `}
              onClick={onClickFollowing}
            >
              &lt;div className={` align-self-center`}>
                &lt;p className={`mb-2`}> Following&lt;/p>{" "}
              &lt;/div>
              {followingSelected ? (
                &lt;div className={`${classes.tabdiv} align-self-center`}>&lt;/div>
              ) : (
                &lt;div>&lt;/div>
              )}
            &lt;/NavLink>
          &lt;/div>

          {/* add each user */}

          {type === "followers" &amp;&amp;
            followers.map((follower, index) => {
              if (index === followers.length - 1) {
                return (
                  &lt;div ref={lastTweetElementRefFollowers} key={index}>
                    &lt;User
                      {...follower}
                      showAction={true}
                      currentuser={
                        currentuserName === follower.userName ? true : false
                      }
                    >&lt;/User>{" "}
                  &lt;/div>
                );
              } else {
                return (
                  &lt;div>
                    &lt;User
                      {...follower}
                      key={index}
                      showAction={true}
                      currentuser={
                        currentuserName === follower.userName ? true : false
                      }
                    />
                  &lt;/div>
                );
              }
            })}
          {type === "followers" &amp;&amp; followers.length === 0 &amp;&amp; !isLoading &amp;&amp; (
            &lt;div>
              &lt;div className={`row`}>
                &lt;img
                  src="https://abs.twimg.com/sticky/illustrations/empty-states/yellow-birds-power-line-800x400.v1.png"
                  alt=""
                />
              &lt;/div>
              &lt;div className={`${classes.noFollowersContainer}`}>
                &lt;p className={`${classes.noFollowers} `}>
                  {" "}
                  Looking for followers?
                &lt;/p>
                &lt;p className={`text-muted h6`}>
                  &lt;small>
                    When someone follows this account, they’ll show up here.
                    Tweeting and interacting with others helps boost followers.
                  &lt;/small>
                &lt;/p>
              &lt;/div>
            &lt;/div>
          )}
          {type === "following" &amp;&amp;
            following &amp;&amp;
            following.map((followingUser, index) => {
              if (index === following.length - 1) {
                return (
                  &lt;div ref={lastTweetElementRefFollowing} key={index}>
                    &lt;User
                      {...followingUser}
                      currentuser={
                        currentuserName === followingUser.userName
                          ? true
                          : false
                      }
                      showAction={true}
                    >&lt;/User>{" "}
                  &lt;/div>
                );
              } else {
                return (
                  &lt;div>
                    &lt;User
                    
                      {...followingUser}
                      currentuser={
                        currentuserName === followingUser.userName
                          ? true
                          : false
                      }
                      key={index}
                      showAction={true}
                    />
                  &lt;/div>
                );
              }
            })}
          {type === "following" &amp;&amp; following.length === 0 &amp;&amp; !isLoading &amp;&amp; (
            &lt;div>
              &lt;div className={`row`}>
                &lt;img
                  src="https://abs.twimg.com/sticky/illustrations/empty-states/yellow-birds-power-line-800x400.v1.png"
                  alt=""
                />
              &lt;/div>
              &lt;div className={`${classes.noFollowersContainer}`}>
                &lt;p className={`${classes.noFollowers}  mb-0 `}>
                  {userName} isn’t{" "}
                &lt;/p>
                &lt;p className={`${classes.noFollowers}  `}> following anyone&lt;/p>
                &lt;p className={`text-muted h5`}>
                  &lt;small>
                    Once they follow accounts, they’ll show up here.
                  &lt;/small>
                &lt;/p>
              &lt;/div>
            &lt;/div>
          )}
          {isLoading &amp;&amp; (
            &lt;ReactLoading
              type={"spin"}
              color={"#1DA1F2"}
              height={"8%"}
              width={"8%"}
              className={`${classes.loadingIcon}`}
            />
          )}
        &lt;/div>
      &lt;/div>
      &lt;RightSideBar />
    &lt;/div>
  );
}

export default FollowingFollowersPage;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-FollowingFollowersPage.html">FollowingFollowersPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Tue May 24 2022 23:47:14 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
