<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: EditProfileButton.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: EditProfileButton.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, Fragment } from "react";
import classes from "./EditProfileButton.module.css";
import "bootstrap/dist/css/bootstrap.min.css";
import CloseIcon from "@mui/icons-material/Close";
import InputBox from "./InputBox";
import ImageUploader from "./ImageUploader";
import instance from "../../axios";
//import { useNextMonthDisabled } from "@mui/lab/internal/pickers/hooks/date-helpers-hooks";

function EditProfileButton(props) {
    /**
   * @module EditProfileButton
   */
  const [fileData, setFileData] = useState();
  const currentuser = JSON.parse(localStorage.getItem("UserInfo"));
  const [croppedCoverPhoto, setCroppedCoverPhoto] = useState(
    currentuser.cover_image_url
      ? currentuser.cover_image_url
      : "https://jannaschreier.files.wordpress.com/2012/03/website-header-blue-grey-background.jpg"
  );
  const [croppedProfilePhoto, setCroppedProfilePhoto] = useState(
    currentuser.profile_image_url
      ? currentuser.profile_image_url
      : "https://www.glidden.com/cms/getmedia/9500a596-cfc5-483d-8d53-28fff52a0444/room-swatch_smoke-grey__90bg-30_073.jpg"
  );
  const [name, setName] = useState(currentuser.name);
  const [bio, setBio] = useState(currentuser.bio);
  const [website, setWebsite] = useState(currentuser.website);
  const [location, setLocation] = useState(currentuser.location);
  const [birth_date, setBirthDate] = useState(
    currentuser.birth_date.slice(0, 10)
  );

  const editCover = (editedcover) => {
    setCroppedCoverPhoto(editedcover);
  };
  const editProfilePhoto = (editedprofile) => {
    setCroppedProfilePhoto(editedprofile);
  };
  const resetModal = () => {
    setCroppedCoverPhoto(
      currentuser.cover_image_url
        ? currentuser.cover_image_url
        : "https://jannaschreier.files.wordpress.com/2012/03/website-header-blue-grey-background.jpg"
    );
    setCroppedProfilePhoto(
      currentuser.profile_image_url
        ? currentuser.profile_image_url
        : "https://www.glidden.com/cms/getmedia/9500a596-cfc5-483d-8d53-28fff52a0444/room-swatch_smoke-grey__90bg-30_073.jpg"
    );
  };

  /**
   * @name onSaveEdits
   * @function onSaveEdits
   * @description Saves the edits of the modal to the database on click save
   */
  const onSaveEdits = async () => {
    //convert blob to file
    const profileFile = await fetch(croppedProfilePhoto)
      .then((r) => r.blob())
      .then(
        (blobFile) => new File([blobFile], "file.jpeg", { type: "image/jpeg" })
      );
    const coverFile = await fetch(croppedCoverPhoto)
      .then((r) => r.blob())
      .then(
        (blobFile) => new File([blobFile], "file.jpeg", { type: "image/jpeg" })
      );

    let formData = new FormData();
    formData.append("name", name);
    formData.append("bio", bio);
    formData.append("website", website);
    formData.append("location", location);
    formData.append("birth_date", birth_date);
    formData.append("media", profileFile);
    formData.append("media", coverFile);

    instance
      .put(`/user/update-profile`, formData)
      .then((res) => {
        props.setData(res.data.user);
        let localStorageData = {
          name: res.data.user.name,
          bio: res.data.user.bio,
          website: res.data.user.website,
          location: res.data.user.location,
          birth_date: res.data.user.birth_date,
          profile_image_url: res.data.user.profile_image_url,
          cover_image_url: res.data.user.cover_image_url,
          username: res.data.user.username,
        };

        //reload page
        if (
          currentuser.profile_image_url !== res.data.user.profile_image_url ||
          currentuser.name !== res.data.user.name
        ) {
          window.location.reload();
        }
        localStorage.setItem("UserInfo", JSON.stringify(res.data.user));
      })
      .catch((err) => {
        console.log(err);
      });
  };

  const changeNameVal = (value) => {
    setName(value);
  };
  const changeBioVal = (value) => {
    setBio(value);
  };
  const changeWebsiteVal = (value) => {
    setWebsite(value);
  };
  const changeLocationVal = (value) => {
    setLocation(value);
  };

  return (
    &lt;Fragment>
      &lt;button
        data-bs-target="#myModal"
        data-bs-toggle="modal"
        className={`${classes.editButton} btn btn-outlined btn-light text-bold p-1 px-3`}
      >
        Edit Profile
      &lt;/button>
      &lt;div
        className={` ${classes.editModal} modal fade `}
        tabIndex="-1"
        id="myModal"
      >
        &lt;div className={`${classes.modalDialog} modal-dialog `}>
          &lt;div className={`${classes.modalContent} modal-content p-0`}>
            &lt;div className={`${classes.modalHeader} modal-header pb-3 pt-2 `}>
              &lt;CloseIcon
                className={`${classes.closeIcon} ps-0  me-4`}
                data-bs-dismiss="modal"
                aria-label="Close"
                onClick={resetModal}
              />
              &lt;h5 className={`${classes.modalTitle} col-3 modal-title`}>
                Edit profile
              &lt;/h5>
              &lt;button
                className={`${classes.saveButton}   text-bold p-1 pt-0 px-3 `}
                type="button"
                data-bs-dismiss="modal"
                aria-label="Close"
                onClick={onSaveEdits}
              >
                Save
              &lt;/button>
            &lt;/div>

            &lt;div className={`${classes.modalBody} modal-body py-0 px-1`}>
              &lt;ImageUploader
                profileOrCover="cover"
                className={classes.coverCropUploader}
                editPhoto={editCover}
                croppedPhoto={croppedCoverPhoto}
              >&lt;/ImageUploader>
              &lt;ImageUploader
                profileOrCover="profile"
                className={classes.profileCropUploader}
                editPhoto={editProfilePhoto}
                croppedPhoto={croppedProfilePhoto}
              >&lt;/ImageUploader>
              &lt;div className={`${classes.coverPhotoEdit} row`}>
                &lt;img
                  width="596"
                  height="198"
                  src={croppedCoverPhoto}
                  alt=""
                  className={`${classes.coverImage} img-fluid py-0`}
                />

                &lt;div className={`${classes.profileImageContainer}`}>
                  &lt;img
                    className={`${classes.profilePhotoEdit} img-fluid`}
                    src={croppedProfilePhoto}
                    alt=""
                  />
                &lt;/div>
              &lt;/div>

              &lt;form action="">
                &lt;InputBox
                  inputName="Name"
                  inputValue={currentuser.name}
                  onChangeVal={changeNameVal}
                >&lt;/InputBox>
                &lt;InputBox
                  inputName="Bio"
                  inputValue={currentuser.bio}
                  onChangeVal={changeBioVal}
                >&lt;/InputBox>
                &lt;InputBox
                  inputName="Location"
                  inputValue={currentuser.location}
                  onChangeVal={changeLocationVal}
                >&lt;/InputBox>
                &lt;InputBox
                  inputName="Website"
                  inputValue={currentuser.website}
                  onChangeVal={changeWebsiteVal}
                >&lt;/InputBox>
                &lt;label
                  htmlFor="birthday"
                  className={`${classes.birthdayLabel}`}
                >
                  Birth date:
                &lt;/label>
                &lt;br />
                &lt;input
                  type="date"
                  id="birthday"
                  name="birthday"
                  value={birth_date}
                  max="2021-01-01"
                  onChange={(e) => {
                    setBirthDate(e.target.value.toString());
                  }}
                  className={`${classes.birthdayInput}`}
                >&lt;/input>
              &lt;/form>
            &lt;/div>
            &lt;div className="modal-footer">&lt;/div>
          &lt;/div>
        &lt;/div>
      &lt;/div>
    &lt;/Fragment>
  );
}

export default EditProfileButton;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-EditProfileButton.html">EditProfileButton</a></li></ul><h3>Global</h3><ul><li><a href="global.html#rotateSize">rotateSize</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Tue May 24 2022 23:55:11 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
